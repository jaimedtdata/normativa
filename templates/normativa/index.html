{% extends 'base_nfr.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h1 class="text-center">Registro de Normativas</h1>
    <br>
    <div class="row">
        <div class="col">
            <a href="{% url 'registrar-normativa' %}" class="btn btn-primary text-white" style="background-color:#24387C;">
                <i class="fas fa-plus"></i>
                Agregar nueva
            </a>
        </div>
    </div>
    <form  class="form-group mt-3" method="GET">
       <div class="row">
        <div class="col-5">
            <input type="text" name="content" class="form-control" placeholder="BUSCAR POR NORMA, TITULO O BASE LEGAL" id="{{ filter.form.id_for_content }}" value="{{request.GET.content}}">
        </div>
        <div class="col-1 form-group" >
            
            <button type="submit" class="btn btn-info btn-lg" >
                <i class="fas fa-search"></i>
            </button>
          </div>
       </div>
    </form>
    <br>
    <table class="table table-bordered">
        <thead>
            <tr>
                <td>T. Norma</td>
                <td>T. Uso</td>
                <td>Sub. Uso</td>
                <td >Norma</td>
                <td>Titulo</td>
                <td>Base Legal</td>
                <td>Articulado</td>
                <td>Documento</td>
                <td>Publicacion</td>
                <td>Observacion</td>
            </tr>
        </thead>
        <tbody>
            {% if entity %}
                {% for norma in entity %}
                <tr>
                    
                    <td>{{norma.tipo_norma}}</td>
                    <td>{{norma.subtipo_uso.tipo_uso}}</td>
                    <td>{{norma.subtipo_uso}}</td>
                    <td>{{norma.norma}}
                        {% if norma.estado == 'NV' %}
                            <small class="fst-italic fw-lighter fs-7 text-danger">*No vigente</small>
                        {% elif norma.estado == 'DP' %}
                            <small class="fst-italic fw-lighter fs-7 text-danger">*Derogado Parcialmente</small>
                        {% endif %}
                    </td>
                    <td>{{norma.name_denom}} 
                        
                    </td>
                    <td>{{norma.base_legal}}</td>
                    <td>{{norma.articulo}}</td>
                    <td class="text-center">
                        {% if norma.document %}
                            <a target="_blank" href="{% url 'ver-pdf' norma.id %}">
                                <i class="fa fa-file-pdf fa-2x text-danger mr-1" aria-hidden="true"></i>
                            </a>
                        {% else %}

                        <span class="text-center"><i class="fa fa-minus fa-2x text-dark" aria-hidden="true"></i></span>
                        {% endif %}
                    </td>
                    <td>{{norma.fecha_publi}}</td>
                    <td>
                        <a href="{% url 'actualizar-normativa' norma.id %}" class="btn btn-warning">
                            <i class="fas fa-edit" ></i>
                        </a>
                    
                        <a onclick="ConfirmDelete({{norma.id}})" href="#" class="btn btn-danger">
                            <i class="fas fa-trash"></i>
                        </a>
                    </td>
                </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>  

    {% include '../partials/_paginator.html' %}

    {% if messages %}
        {% for m in messages %}
        
        <script>
            Swal.fire({
                'title' : "Completado",
                "text" : "{{m}}",
                "icon" : "success",
            })
        </script>
        
        {% endfor %}
    {% endif %}
</div>
{% endblock %}

{% block js %}
    <script>
        function ConfirmDelete(id){
            Swal.fire({
            title: 'Esta seguro que desea eliminar?',
            text: "Esta accion es irreversible!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Si, eliminar!'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = `/normativas/${id}/eliminar`
                }
            })
        }
    </script>
{% endblock %}